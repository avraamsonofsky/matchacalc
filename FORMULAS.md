# Формулы расчёта показателей MatchaCalc

## 1. Окупаемость при сдаче в аренду

**Определение:** Время (в годах), за которое инвестор вернёт стоимость лота, сдавая его в аренду.

**Формула:**
Находим минимальный t, при котором:
```
SUM(i=1 to t) Rent_i >= P0
```

где:
- `P0` — цена покупки объекта
- `Rent_1 = 0.5 * A * R0 * 12` — арендный доход за первый год (6 месяцев подготовки)
- `Rent_t = A * R0 * 12 * (1 + g_r')^(t-2)` — арендный доход за год t (для t >= 2)
- `A` — площадь объекта (м²)
- `R0` — стартовая годовая арендная ставка (руб/м²/мес, умножается на 12 для годовой)
- `g_r' = g_r * k_s` — эффективный годовой темп роста арендных ставок
  - `g_r` — базовый темп роста из отчёта
  - `k_s` — коэффициент сценария (пессимистичный < 1, базовый = 1, оптимистичный > 1)

**Алгоритм:**
1. Накапливаем арендные платежи по годам
2. Когда накопленная сумма >= P0, находим точное время с линейной интерполяцией

**Пример:**
Если P0 = 50 000 000 ₽, A = 150 м², R0 = 50 000 ₽/м²/мес, g_r' = 0.10:
- Год 1: Rent_1 = 0.5 * 150 * 50 000 * 12 = 45 000 000 ₽
- Накоплено: 45 000 000 ₽ < 50 000 000 ₽
- Год 2: Rent_2 = 150 * 50 000 * 12 * 1.10 = 99 000 000 ₽
- Накоплено: 45 000 000 + 99 000 000 = 144 000 000 ₽ >= 50 000 000 ₽
- Интерполяция: окупаемость ≈ 1.05 года

---

## 2. Окупаемость при сдаче в аренду с последующей продажей

**Определение:** Оптимальный срок владения, при котором сумма арендных платежей + стоимость продажи = 2 * P0 (удвоение вложенной суммы).

**Формула:**
Находим минимальный t, при котором:
```
SUM(i=1 to t) Rent_i + Price_t >= 2 * P0
```

где:
- `P0` — цена покупки объекта
- `Rent_i` — арендный доход за год i (см. формулу выше)
- `Price_t = P0 * (1 + g_p')^t` — стоимость объекта к концу года t
- `g_p' = g_p * k_s` — эффективный годовой темп роста стоимости
  - `g_p` — базовый темп роста из отчёта
  - `k_s` — коэффициент сценария

**Алгоритм:**
1. Для каждого года t вычисляем:
   - Накопленную сумму арендных платежей: `SUM(i=1 to t) Rent_i`
   - Стоимость продажи: `Price_t = P0 * (1 + g_p')^t`
   - Общую стоимость: `Total = Rent_total + Price_t`
2. Когда `Total >= 2 * P0`, находим точное время с линейной интерполяцией

**Пример:**
Если P0 = 50 000 000 ₽, A = 150 м², R0 = 50 000 ₽/м²/мес, g_r' = 0.10, g_p' = 0.04:
- Цель: 2 * 50 000 000 = 100 000 000 ₽
- Год 1: Rent = 45 000 000, Price = 52 000 000, Total = 97 000 000 < 100 000 000
- Год 2: Rent = 45 000 000 + 99 000 000 = 144 000 000, Price = 54 080 000, Total = 198 080 000 >= 100 000 000
- Интерполяция: окупаемость ≈ 1.015 года

---

## 3. Срок удвоения стоимости

**Определение:** Время, за которое стоимость объекта удвоится при заданном темпе роста.

**Формула:**
```
T_2x = LN(2) / LN(1 + g_p')
```

где:
- `g_p'` — эффективный годовой темп роста стоимости
- `LN` — натуральный логарифм

**Вывод формулы:**
```
Price_t = P0 * (1 + g_p')^t = 2 * P0
(1 + g_p')^t = 2
t * LN(1 + g_p') = LN(2)
t = LN(2) / LN(1 + g_p')
```

**Пример:**
Если g_p' = 0.04 (4% в год):
- T_2x = LN(2) / LN(1.04) ≈ 0.693 / 0.039 ≈ 17.7 лет

---

## Примечания

- Все расчёты учитывают 6 месяцев подготовки в первый год (Rent_1 = 0.5 * годовая ставка)
- Применяются коэффициенты сценария к темпам роста
- Используется линейная интерполяция для точности расчёта окупаемости
- Максимальный срок поиска окупаемости: 50 лет (защита от бесконечного цикла)
